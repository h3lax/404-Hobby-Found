{% extends 'base.html.twig' %}

{% block title %}Hobby Found{% endblock %}

{% block body %}
<main role="main">
  <div class="album py-5 bg-light">
    <div class="container">
      <div class="row">
        {% for club in clubs %}
          {% if not club.users.contains(app.user) %}
          <div class="col-md-4">
            <div class="card mb-4 shadow-sm">
              <div class="card-body">
                <p class="card-text">{{ club.name }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <div class="btn-group">
                    {% if app.user %}
                      <form action="{{ path('clubJoin', {'id': club.id}) }}" method="post" class="join-form" data-club-name="{{ club.name }}">
                        <button type="button" class="btn btn-sm btn-outline-secondary join-button me-2" data-toggle="modal" data-target="#joinClubModal">Join</button>
                      </form>
                      <button type="button" class="btn btn-sm btn-outline-secondary view-description" data-description="{{ club.description }}" data-toggle="modal" data-target="#clubModal">View</button>
                      {% else %}
                        <button type="button" class="btn btn-sm btn-outline-secondary view-description" data-description="{{ club.description }}" data-toggle="modal" data-target="#clubModal">View</button>
                      {% endif %}
                    </div>
                  
                </div>
              </div>
            </div>
          </div>
          {% endif %}
        {% endfor %}
      </div>    
    </div>
  </div>

  <!-- Club Description Modal -->
  <div class="modal fade" id="clubModal" tabindex="-1" role="dialog" aria-labelledby="clubModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="clubModalLabel">Club Description</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="clubDescription"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Join Club Confirmation Modal -->
  <div class="modal fade" id="joinClubModal" tabindex="-1" role="dialog" aria-labelledby="joinClubModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="joinClubModalLabel">Join Club Confirmation</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="joinClubMessage"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <form id="confirmJoinForm" action="" method="post">
            <button type="submit" class="btn btn-primary">Confirm</button>
          </form>
        </div>
      </div>
    </div>
  </div>

</main>

{% block javascripts %}
{{ parent() }}
<script>
  // JavaScript for handling modals
  document.addEventListener('DOMContentLoaded', function () {
    // Club Description Modal
    const viewButtons = document.querySelectorAll('.view-description');
    viewButtons.forEach(button => {
      button.addEventListener('click', function () {
        const description = this.getAttribute('data-description');
        document.getElementById('clubDescription').innerText = description;
      });
    });

    // Join Club Modal
    const joinButtons = document.querySelectorAll('.join-button');
    joinButtons.forEach(button => {
      button.addEventListener('click', function () {
        const clubName = this.closest('.join-form').getAttribute('data-club-name');
        document.getElementById('joinClubMessage').innerText = `Are you sure you want to join the club "${clubName}"?`;
        const formAction = this.closest('.join-form').getAttribute('action');
        document.getElementById('confirmJoinForm').setAttribute('action', formAction);
      });
    });
  });
</script>
{% endblock %}
{% endblock %}
